How An "Evil Router" Can Help You Build Wi-Fi Devices That Actually Work