<h3><a name="Read_Part_1_of_2_urlhttpwwwfastcolabscom3007393opencompanyinsidemindfoursquaresmapsgeniusInside_The_Mind_Of_Foursquares_Maps_Geniusurl">Read Part 1 of 2: <a href="http://www.fastcolabs.com/3007393/open-company/inside-mind-foursquares-maps-genius" target="_self">Inside The Mind Of Foursquare’s Maps Genius</a></a></h3>

<aside class="info"><div class="info-inner"><p>The Foursquare engineer we interviewed in Part 1 of 2 of this series, David Blackman, is also the creator of the open-source geocoder Twofishes, which went live last April. With the help of a small internal team and the larger open GIS community, Blackman has been building more of that open infrastructure, along with the proprietary things Foursquare is using to map and understand the world.</p></div></aside>

<p><p class="interview-question">Who internally uses the projects you’re building?</p></p>

<p><p class="interview-answer">Our entire Explore team is constantly chomping at this data and our analytics team is just in love with this. I hooked up our geographic data yesterday to DMAs and they were thrilled. I also hooked up our venue data to get a better sense of the U.S. metros.</p></p>

<p><p class="interview-question">What is your role, and how many people do you have working on maps here at Foursquare?</p></p>

<p><p class="interview-answer">I'm the primary developer of a lot of our geographic infrastructure. There are three people who touch geo here.  Everyone has a slightly different way that they think about how the geographic data works. We're also working with a well-regarded open source cartography guy, who is helping us make sense of the world. I've learned a lot about how the U.S. fits together, but his brain is able to hold how the whole world fits together. He understands that there was a law passed in England that changed the way that cities and counties and states fit together 10 years ago and how this influences the way that we're going to draw and model cities. </p></p>

<p><p class="interview-question">A lot of your geographic infrastructure consists of things you built and maintain internally. But you of course can’t do it all. What are some outside tools you use to build out Foursquare’s maps and geolocation functionality? </p></p>

<p><p class="interview-answer">We use a really awesome open source library from Google called S2. It's just a really great geographic spherical geometry library. It's very good at drawing these boxes. What S2 lets us do is it overlays a multi-level grid on the world. This is a really great abstraction. Even just tiling the whole world at one constant level is a nice way to divide up the world. You don't need polygon data to work with S2. It just covers the whole world. We've built tooling on top of it. S2Map is a site that I wrote so we could go visualize coverings and visualize the data.  A lot of our Explore technology is currently rooted in S2. We can also do things like take all your check-ins and build an S2 covering of that. Now we have a rough approximation of where you've been. We can name each of these cells. They're easier to save in the database. We use S2 quite a bit.   </p></p>

<p><p class="interview-question">Check-ins from around the whole world is a pretty big data set. How do you break it down? </p></p>

<p><p class="interview-answer">With MapReduce, you can break up a big task into small tasks. This is a really great way to break up any world-sized tasks into small tasks. Each reducer is one bucket and you're seeing the buckets. Each of these cells you can think of as a bucket. This is actually how we do some geographic processing right now. We take the polygon, we do this S2 covering, and then we put those into our reduce buckets. And then we take check-ins or venues and we take the S2 covering of those and we put them into the same buckets. And now I have matched up venues and polygons in my reduce bucket. It's a great, efficient library. It's very high level. It's solely for building geographic databases. </p></p>

<p><p class="interview-question"> I imagine you get geographic data from a variety of sources. Which ones are the easiest to work with? </p></p>

<p><p class="interview-answer">The U.S. government is really amazing. It gives out <a href="http://www.census.gov/geo/maps-data/data/tiger.html" target="_blank">this TIGER project</a>, which is part of the census. It's basically a full digital map of the United States. It's every road, every city, metros, these things that are sort of like Zip codes, just a ton of data. If [Foursquare] was just the U.S. our job would be done. There are other open geographic data repositories. There are these guys <a href="http://www.naturalearthdata.com/" target="_blank">Natural Earth</a>. It's a project that grew out of some cartography that happened at the <em>Washington Post</em>. Honestly, every geographic visualization you see, it's likely that the outlines of the countries you're seeing are the Natural Earth countries. They're a set of country and state polygons, basically for printing, at the largest, at wall size.</p></p>

<figure class="inline-large inline">
<img src="http://www.fastcompany.com/multisite_files/fastcompany/imagecache/inline-large/inline/2013/03/3007394-inline-paris-map-checkins.jpg" alt=""/>
</figure>

<p><p class="interview-question">What programming languages do you guys use? </p></p>

<p><p class="interview-answer">Foursquare is a Scala shop. Scala has a really great benefit of being built on the JVM [Java Virtual Machine] so we get to pull in all the Java libraries that we want. And there are some really great Java libraries for geographic work as well. The Java topology suite is a standard one. Most of what we do is in Scala Java. The PostGIS database is a really popular tool in a lot of geo work. We're migrating away from it in favor of code that we've written. The project we're working on to create city polygons for the world is all built on PostGIS. It's an easy way to take geographic data, stick it in a database, query it with geographic primitives. When you start with<a href="http://www.openstreetmap.org/" target="_blank"> Open Street Map</a>, you download planet.osm and then the first thing you do is you spend 12 hours just putting it into a PostGIS database. That lets you treat geographic data as a database. And then we use the Geonames project, and we use our own homegrown suite of tools: our geocoder, our reverse geocoder, and then the various Map Reduces and other data infrastructure we built on that. </p></p>

<p><p class="interview-question">What else do you use to build on PostGIS?</p></p>

<p><p class="interview-answer">We have a geographic data repository. Before you build your geocoder you want to get all of your data into a nice, standardized format that things like a MapReduce can run over. So we've built MapReduces on top of all of our geographic data as well. Here’s another fun tool we built that we'll probably open source when we have some time: There’s a standard interchange for geographic data called Shapefiles. This [program] reads any Shapefile and then writes back to a Shapefile, which means you can also visualize it in the standard suite of geographic tools. This is called quantum GIS (qGIS). It's *the* open source suite for working with Shapefiles, which is how most geographic data is exchanged. <br />
</p></p>

<p><p class="interview-question">Most of this data is going toward building Foursquare's geographic infrastructure as it exists today. What are some other interesting things you wind up doing with that data?</p></p>

<p><p class="interview-answer">The more we have the data, the longer the data sticks around, the more use we find for it. It just starts finding its way into every database and we have all these tables of aggregations: what cities our users have been to, what venues they've been to, what artists they've seen. One of the fundamental things has been how we build the user geo aggregation. This is letting us do that. We can start thinking about cities you've been to before and places you’ve been to before and say, “Hey, you should explore this other place today.” That'd be great, but we need the understanding first. </p></p>

<p><p class="interview-question">What kind of experimental apps are you thinking of building internally? </p></p>

<p><p class="interview-answer">I've been thinking: Can we build a tool that lets us crowdsource neighborhoods? Because neighborhoods are so weird. Let's just ask people. Let's just build a phone app. We're thinking about web UI's for it. We're thinking about doing a cut of neighborhoods with Foursquare and <a href="http://code.flickr.net/2008/10/30/the-shape-of-alpha/" target="_blank">Flickr data</a> and then seeding those and then people hopefully over time can refine it. I just was looking at an open source map toolkit online that's pretty good at drawing polygons. This is basically all I need. I just need to ask people, do you want to help me with Williamsburg? And then just start drawing. The MapBox guys have this huge commitment to satellite data. And satellite data is cool. It's super-open. A lot of Open Street Map is drawn on top of satellite data. So I was thinking this morning, I should call up the MapBox folks, we'll run this on top of MapBox satellite and start drawing neighborhood polygons.</p></p>

<p><p class="interview-question">It sounds like you need the help of the hive-mind. How else can the community pitch in?</p></p>

<p><p class="interview-answer">Lots of people think about this. There's Livehoods, which tries to figure out not necessarily the neighborhoods that you and I think of, but they're taking Foursquare check-ins and trying to figure out the neighborhoods that people live in. Where are things clustered? You might think the Upper West Side is like this, but really it bleeds into Inwood. They're looking at where people go between Foursquare check-ins. There's a project out of Boston that's doing crowdsourced neighborhoods totally separate from Foursquare. I would love more hours in my day to both be building out our geographic data and the open geographic data. The best we can do is help each other. It's too big of a problem. I need people in Russia and France thinking about places in France and Russia. I just can't hold every city in the world in my head and how they fit together. </p></p>